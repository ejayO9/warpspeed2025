Running redirect functionality tests...

Extraction test results:
Income details: I earn 80000 per month as salary.
Upcoming spends: I have upcoming wedding expenses of 10 lakhs next year.
Dependents info: I have a spouse and 2 children as dependents.
Car price: 4500000.0
All info collected: True
--------------------------------------------------

Testing conversation flow with separate messages:
--------------------------------------------------

1. User: My salary is 80000 per month
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'current_phase']
   Agent: My salary is 80000 per month...
   All info collected: False
   Current phase: collecting_info
   Chat info keys: []
DEBUG: conversation_agent returning updates: ['messages', 'chat_info', 'all_info_collected']
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: Thank you for sharing your salary! That's a solid income. Do you have any other sources of income, like investments or a side hustle? Also, are there ...
   All info collected: False
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']

2. User: I have upcoming wedding expenses of 10 lakhs
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: I have upcoming wedding expenses of 10 lakhs...
   All info collected: False
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']
DEBUG: conversation_agent returning updates: ['messages', 'chat_info', 'all_info_collected']
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: That's a significant expense, but it sounds exciting! Planning a wedding can be quite a journey. Are there any other big expenses on the horizon, like...
   All info collected: False
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']

3. User: I have a spouse and 2 children as dependents
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: I have a spouse and 2 children as dependents...
   All info collected: False
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']
DEBUG: conversation_agent returning updates: ['messages', 'chat_info', 'all_info_collected']
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: Thanks for sharing that! It’s important to consider your family's needs when planning finances. With a spouse and two children, there might be ongoing...
   All info collected: True
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']

4. User: I'm planning to buy a car worth 45 lakhs
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'all_info_collected']
   Agent: I'm planning to buy a car worth 45 lakhs...
   All info collected: True
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']
DEBUG: conversation_agent returning updates: ['messages', 'chat_info', 'all_info_collected', 'car_price']
DEBUG stream_chat: Chunk keys: ['messages', 'user_id', 'chat_info', 'current_phase', 'car_price', 'all_info_collected']
   Agent: That's a significant investment in a car! It sounds like you have some big financial commitments coming up, including the wedding and the car purchase...
   All info collected: True
   Current phase: collecting_info
   Chat info keys: ['income_details', 'upcoming_spends', 'dependents_info', 'additional_info']
